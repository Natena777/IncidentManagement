--All Active Sessions In DB
select
    pid,
    usename,
    application_name,
    client_addr,
    client_port,
    backend_start,
    state,
    state_change,
    query_start,
    query
from pg_stat_activity
order by backend_start desc;

--Kill Sessions
--terminate
select pg_terminate_backend(12345); --PID

--force kill
select pg_cancel_backend(12345);  --PID

--Kill All Session Not Me
select pg_terminate_backend(pid)
from pg_stat_activity
where pid <> pg_backend_pid()
  and datname = current_database();

--Kill All Session On user
select pg_terminate_backend(pid)
from pg_stat_activity
where usename = 'specific_user'
  and pid <> pg_backend_pid();

--all Triggers
SELECT
    trigger_name,
    event_manipulation,
    event_object_table,
    action_timing,
    action_statement
FROM information_schema.triggers
WHERE trigger_schema = 'public'
ORDER BY event_object_table, trigger_name;


--trigger Details
select
    t.trigger_name,
    t.event_manipulation as event_type,
    t.event_object_table as table_name,
    t.action_timing as timing,
    t.action_statement,
    t.action_orientation as orientation,
    p.proname AS function_name,
    pg_get_functiondef(p.oid) as function_definition
from information_schema.triggers t
left join pg_proc p ON p.proname = replace(SPLIT_PART(t.action_statement, ' ', 3), '()', '')
where t.trigger_name = 'set_case_number'
  and t.trigger_schema = 'public';

--All Tables
select
    table_name,
    table_type
from information_schema.tables
where table_schema = 'public'
order by table_name;

--All Table Columns
select
    table_schema,
    table_name,
    column_name,
    data_type,
    character_maximum_length,
    is_nullable,
    column_default
from information_schema.columns
where table_name = 'cases'
  and table_schema = 'public'
order by ordinal_position;

--All Table Indexes
select *
from pg_indexes
where tablename = 'cases'
  and schemaname = 'public';

--All Table Constraints
select
    tc.table_name,
    tc.constraint_name,
    tc.constraint_type,
    kcu.column_name,
    ccu.table_name as parent_table_name,
    ccu.column_name as parent_column_name
from information_schema.table_constraints tc
left join information_schema.key_column_usage kcu
    on tc.constraint_name = kcu.constraint_name
left join information_schema.constraint_column_usage ccu
    on tc.constraint_name = ccu.constraint_name
where tc.table_schema = 'public'
and tc.table_name = 'cases'
order by tc.table_name, tc.constraint_type;


--Active Querries In DB
select
    pid,
    usename,
    application_name,
    client_addr,
    state,
    query,
    query_start
from pg_stat_activity
where state != 'idle'
order by query_start;